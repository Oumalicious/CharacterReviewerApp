<!DOCTYPE HTML>
<!-- Name: Vincent Xue -->
<html>
	<head>
		<title>
			CISC 4900 Word Bank Creator
		</title>
	</head>
	<style>
		.inputContainer{
			padding: 5px 20px 5px 0px;
		}
		
		.choiceContainer{
			padding: 5px 10px 5px 10px
		}
	</style>
	<script>
		//variable handler for canceling edits
		var prevObj = {};
		var wordBanksUsed = {};
		var wordBanksAdded = {};
		var wordBanksUsedStr = "";
		var studentSheet, answerSheet, incorrectSheet;
		var pronounciationChoices, translationChoices;
		var testSheet, testIndex, score, maxScore;
		var selectedPronounciation, selectedTranslation;
		var questionInputTimer, testInputTimer, QUESTION_TIMER, RETEST, OUT_OF_TIME, TEST_DONE, RAPID_TEST;
		var attempt = 1;
		//take user parameters to create an entry
		function insertWord(character, pronounciation, translation){
			//alert user if missing parameter
			if(character === '' || pronounciation === '' ||  translation === ''){
				headerChange(0);
				return;
			}
			//create DOM elements with the value of the inputs
			let newWordDiv = document.createElement('div');
			newWordDiv.style.display = "flex";
			let indexDiv = document.createElement('div');
			let index = document.getElementById('words').childElementCount + 1;
			indexDiv.innerHTML = index + ".";
			indexDiv.style.width = "9%";
			indexDiv.style.padding = ".25% 0 .25% 9%"
			let characterDiv = document.createElement('div');
			characterDiv.innerHTML = character;
			characterDiv.style.width = "15.7%";
			let pronounciationDiv = document.createElement('div');
			pronounciationDiv.innerHTML = pronounciation;
			pronounciationDiv.style.width = "30.7%";
			let translationDiv = document.createElement('div');
			translationDiv.innerHTML = translation;
			translationDiv.style.width = "27.273%";
			let editButton = document.createElement('button');
			editButton.innerHTML = "Edit";
			editButton.style.margin = ".25% 0";
			//create buttons with parameters of the inputted fields
			editButton.onclick = function(){
				editEntry(this);
			};
			let deleteButton = document.createElement('button');
			deleteButton.innerHTML = "Delete";
			deleteButton.style.margin = ".25% 0";
			deleteButton.onclick = function(){
				deleteEntry(this);
			};
			//append elements to bank
			newWordDiv.id = index;
			newWordDiv.appendChild(indexDiv);
			newWordDiv.appendChild(characterDiv);
			newWordDiv.appendChild(pronounciationDiv);
			newWordDiv.appendChild(translationDiv);
			newWordDiv.appendChild(editButton);
			newWordDiv.appendChild(deleteButton);
			let words = document.getElementById("words");
			words.appendChild(newWordDiv);
			//reset values and change focus for efficiency
			document.getElementById("inputCharacter").value = "";
			document.getElementById("inputPronounciation").value = "";
			document.getElementById("inputTranslation").value = "";
			headerChange(1);
			document.getElementById("inputCharacter").focus();
		}
		
		//text to indicate changes/note about the word bank
		function headerChange(number){
			let headerText = document.getElementById('headerText');
			switch(number){
				//missing field
				case 0:
					headerText.innerHTML = "Invalid entry! Please completely fill out the entries.";
					headerText.style.color = "red";
					headerText.style.display = "block";
					document.getElementById("headerBreak").style.display = "none";
					break;
				//no words
				case 1:
					let length = document.getElementById('words').childElementCount;
					if(length == 0){
						headerText.innerHTML = "The word bank is currently empty.";
						headertText.style.color = "black";
						headerText.style.display = "block";
						document.getElementById("headerBreak").style.display = "none";
					}else{
						headerText.style.display = "none";
						document.getElementById("headerBreak").style.display = "block";
					}
					break;
				//no word bank title
				case 2:
					headerText.innerHTML = "Word bank is missing a title!";
					headerText.style.color = "red";
					headerText.style.display = "block";
					document.getElementById("headerBreak").style.display = "none";
					break;
				//invalid timer
				case 3:
					headerText.innerHTML = "Invalid test timer. Please use the HOUR:MINUTE format.";
					headerText.style.color = "red";
					headerText.style.display = "block";
					document.getElementById("headerBreak").style.display = "none";
					break;
				case 4:
					headerText.innerHTML = "Invalid question timer. Please enter only numbers for the question timer.";
					headerText.style.color = "red";
					headerText.style.display = "block";
					document.getElementById("headerBreak").style.display = "none";
					break;
				case 5:
					headerText.innerHTML = "Need at least 3 words to start the test.";
					headerText.style.color = "red";
					headerText.style.display = "block";
					document.getElementById("headerBreak").style.display = "none";
					break;
			}
		}
		
		//turn div into input fields
		function editEntry(buttonNode){
			let words = document.getElementById("words").childNodes;
			let index = parseInt(buttonNode.parentNode.id)-1;
			let entry = words[index].childNodes;
			let indexDiv = document.createElement('div');
			indexDiv.innerHTML = parseInt(index) + 1 + ".";
			indexDiv.style.width = "9%";
			indexDiv.style.padding = ".25% 0 .25% 9%";
			let character = entry[1].innerHTML;
			let characterDiv = document.createElement('input');
			characterDiv.form = "text";
			characterDiv.value = character;
			characterDiv.style.width = "14%";
			characterDiv.style.marginRight = "1%";
			let pronounciation = entry[2].innerHTML;
			let pronounciationDiv = document.createElement('input');
			pronounciationDiv.form = "text";
			pronounciationDiv.value = pronounciation;
			pronounciationDiv.style.width = "29%";
			pronounciationDiv.style.marginRight = "1%";
			let translation = entry[3].innerHTML;
			let translationDiv = document.createElement('input');
			translationDiv.form = "text";
			translationDiv.value = translation;
			translationDiv.style.width = "18%";
			translationDiv.style.marginRight = ".2%";
			let exitButton = document.createElement('button');
			exitButton.innerHTML = "Exit edit";
			exitButton.style.margin = ".25% .5%";
			exitButton.onclick = function(){
				exitEntry(index);
			};
			let saveButton = document.createElement('button');
			saveButton.innerHTML = "Save Change";
			saveButton.style.margin = ".25% .5%";
			saveButton.onclick = function(){
				saveEntry(index);
			};
			prevObj[index] = {};
			prevObj[index]["character"] = entry[1].innerHTML;
			prevObj[index]["pronounciation"] = entry[2].innerHTML;
			prevObj[index]["translation"] = entry[3].innerHTML;
			const divCollection = Array.from(entry);
			while(divCollection.length > 0){
				entry[0].parentNode.removeChild(entry[0]);
				divCollection.pop();
			}
			words[index].appendChild(indexDiv);
			words[index].appendChild(characterDiv);
			words[index].appendChild(pronounciationDiv);
			words[index].appendChild(translationDiv);
			words[index].appendChild(exitButton);
			words[index].appendChild(saveButton);
		}
		
		//turn input fields into divs and revert to old value
		function exitEntry(index){
			let words = document.getElementById("words").childNodes;
			let entry = words[index].childNodes;
			let indexDiv = document.createElement('div');
			indexDiv.innerHTML = parseInt(index) + 1 + ".";
			indexDiv.style.width = "9%";
			indexDiv.style.padding = ".25% 0 .25% 9%";
			let characterDiv = document.createElement('div');
			characterDiv.innerHTML = prevObj[index].character;
			characterDiv.style.width = "15.7%";
			let pronounciationDiv = document.createElement('div');
			pronounciationDiv.innerHTML = prevObj[index].pronounciation;
			pronounciationDiv.style.width = "30.7%";
			let translationDiv = document.createElement('div');
			translationDiv.innerHTML = prevObj[index].translation;
			translationDiv.style.width = "27.273%";
			let editButton = document.createElement('button');
			editButton.innerHTML = "Edit";
			editButton.style.margin = ".25% 0";
			editButton.onclick = function(){
				editEntry(this);
			};
			let deleteButton = document.createElement('button');
			deleteButton.innerHTML = "Delete";
			deleteButton.style.margin = ".25% 0";
			deleteButton.onclick = function(){
				deleteEntry(this);
			};
			const divCollection = Array.from(entry);
			while(divCollection.length > 0){
				entry[0].parentNode.removeChild(entry[0]);
				divCollection.pop();
			}
			words[index].appendChild(indexDiv);
			words[index].appendChild(characterDiv);
			words[index].appendChild(pronounciationDiv);
			words[index].appendChild(translationDiv);
			words[index].appendChild(editButton);
			words[index].appendChild(deleteButton);
			headerChange(1);
		}
		
		//turn input fields into divs with new value
		function saveEntry(index){
			let words = document.getElementById("words").childNodes;
			let entry = words[index].childNodes;
			if(entry[1].value == "" || entry[2].value == "" || entry[3].value == ""){
				headerChange(0);
				return;
			}
			let indexDiv = document.createElement('div');
			indexDiv.innerHTML = parseInt(index) + 1 + ".";
			indexDiv.style.width = "9%";
			indexDiv.style.padding = ".25% 0 .25% 9%";
			let characterDiv = document.createElement('div');
			characterDiv.innerHTML = entry[1].value;
			characterDiv.style.width = "15.7%";
			let pronounciationDiv = document.createElement('div');
			pronounciationDiv.innerHTML = entry[2].value;
			pronounciationDiv.style.width = "30.7%";
			let translationDiv = document.createElement('div');
			translationDiv.innerHTML = entry[3].value;
			translationDiv.style.width = "27.273%";
			let editButton = document.createElement('button');
			editButton.innerHTML = "Edit";
			editButton.style.margin = ".25% 0";
			editButton.onclick = function(){
				editEntry(this);
			};
			let deleteButton = document.createElement('button');
			deleteButton.innerHTML = "Delete";
			deleteButton.style.margin = ".25% 0";
			deleteButton.onclick = function(){
				deleteButton(this);
			};
			const divCollection = Array.from(entry);
			while(divCollection.length > 0){
				entry[0].parentNode.removeChild(entry[0]);
				divCollection.pop();
			}
			words[index].appendChild(indexDiv);
			words[index].appendChild(characterDiv);
			words[index].appendChild(pronounciationDiv);
			words[index].appendChild(translationDiv);
			words[index].appendChild(editButton);
			words[index].appendChild(deleteButton);
		}
		
		//decrement the index of every entry after the selected, then delete the selected entry
		function deleteEntry(entry){
			let tempEntry = entry.parentNode.parentNode;
			let index = parseInt(entry.parentNode.id);
			while(tempEntry.childNodes[index]){
				let indexDiv = tempEntry.childNodes[index].childNodes[0];
				indexDiv.innerHTML = parseInt(index) + ".";
				indexDiv.parentNode.id = index;
				++index;
			}
			entry.parentNode.parentNode.removeChild(entry.parentNode);
		}
		
		//read all divs and turn it into a downloadable JSON object
		function createBank(){
			let title = document.getElementById("bankTitle").value;
			//prompt user if no title for word bank
			if(title == ""){
				headerChange(2);
				return;
			}
			wordBanksUsed[title] = true;
			let bankUsedDiv = document.createElement("div");
			bankUsedDiv.innerHTML = Object.keys(wordBanksUsed).length + ". " + title;
			let wordsBanksUsedDiv = document.getElementById("wordBanksUsedDiv");
			wordsBanksUsedDiv.appendChild(bankUsedDiv);
			//start building JSON by reading the "word bank"
			let wordBank = {};
			wordBank[title] = {};
			let words = document.getElementById("words").childNodes;
			Array.prototype.forEach.call(words, function(entry){
				wordBank[title][entry.childNodes[1].innerHTML] = {};
				wordBank[title][entry.childNodes[1].innerHTML]["pronounciation"] = entry.childNodes[2].innerHTML;
				wordBank[title][entry.childNodes[1].innerHTML]["translation"] = entry.childNodes[3].innerHTML;
			});
			let questionTimer = document.getElementById("questionTimerInput").value;
			let testTimer = document.getElementById("testTimerInput").value;
			//using the 0 integer as a field to access JSON data outside of the word banks
			if((questionTimer && questionTimer != "") || (testTimer && testTimer != "")){
				wordBank[title][0] = {};
				if(questionTimer && questionTimer != ""){
					if(validTime(questionTimer, "question")){
						wordBank[title][0]["questionTimer"] = questionTimer;
					}else{
						return;
					}
				}
				if(testTimer && testTimer != ""){
					if(validTime(testTimer, "timer")){
						wordBank[title][0]["testTimer"] = testTimer;
					}else{
						return;
					}
				}
			}
			let data = "text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(wordBank));
			let downloader = document.getElementById('download');
			downloader.setAttribute("href", "data:" + data);
			downloader.setAttribute("download", title + ".json");
		}
		
		//read inputted JSON files
		function onChange(event){
			let banks = event.target.files;
			for(let i = 0; i < banks.length; ++i){
				let wordBankName = banks[i].name.substring(0,banks[i].name.length-5);
				if(Object.keys(wordBanksUsed).length  == 0){
					document.getElementById("bankTitle").value = wordBankName;
				}
				if(wordBanksUsed[wordBankName]){
					continue;
				}
				let reader = new FileReader();
				reader.onload = (function(event){
					let obj = JSON.parse(event.target.result)[wordBankName];
					Object.keys(obj).forEach(entry =>{
							if(entry != 0){
								insertWord(entry, obj[entry].pronounciation, obj[entry].translation);
								wordBanksUsed[wordBankName] = true;
							}else{
								if(obj[0]["questionTimer"]){
									document.getElementById("questionTimerInput").value = obj[0]["questionTimer"];
								}
								if(obj[0]["testTimer"]){
									document.getElementById("testTimerInput").value = obj[0]["testTimer"];
								}
							}
					});
					let bankUsedDiv = document.createElement("div");
					bankUsedDiv.innerHTML = Object.keys(wordBanksUsed).length + ". " + wordBankName;
					let wordsBanksUsedDiv = document.getElementById("wordBanksUsedDiv");
					wordsBanksUsedDiv.appendChild(bankUsedDiv);
				});
				reader.readAsText(banks[i]);
			}
		}
		
		function shuffle(array) {
			let currentIndex = Object.keys(array).length, temporaryValue, randomIndex;
			let SEVEN_TIMES_THE_CHARM = 7;
			while(SEVEN_TIMES_THE_CHARM > 0){
				while (0 !== currentIndex) {
					randomIndex = Math.floor(Math.random() * currentIndex);
					currentIndex -= 1;
					temporaryValue = array[currentIndex];
					array[currentIndex] = array[randomIndex];
					array[randomIndex] = temporaryValue;
				}
				SEVEN_TIMES_THE_CHARM--;
			}
			 return array;
		}
		
		function startTest(PROTOCOL){
			let tempWords = document.getElementById("words").children;
			if(tempWords.length < 3){
				headerChange(5);
				return;
			}
			TEST_DONE = false;
			let testTimer = document.getElementById("testTimerInput").value;
			studentSheet = {};
			studentSheet[0] = {};
			if(testTimer && testTimer != ""){
				if(validTime(testTimer, "timer")){
					document.getElementById("testTimer").style.display = "block";
					studentSheet[0]["testTimer"] = testTimer;
					startCountDownTimer(document.getElementById("testTimerInput").value);
					OUT_OF_TIME = false;
				}else{
					return;
				}
			}
			let questionTimer = document.getElementById("questionTimerInput").value;
			if(questionTimer && questionTimer != ""){
				if(validTime(questionTimer, "question")){
					document.getElementById("questionTimer").style.display = "block";
					QUESTION_TIMER = true;
					studentSheet[0]["questionTimer"] = questionTimer + ":00";
				}else{
					return;
				}
			}
			let rapidTest = document.getElementById("rapidCheckBox");
			if(rapidTest.checked){
				RAPID_TEST = true;
			}
			let words = document.getElementById("words").childNodes;
			document.getElementById("uiContainer").style.display = "none";
			document.getElementById("bankUiContainer").style.display = "none";
			document.getElementById("testContainer").style.display = "block";
			pronounciationChoices = [];
			translationChoices = [];
			switch(PROTOCOL){
				case 0:
					answerSheet = {};
					Object.keys(words).forEach(entry =>{
						let character = words[entry].childNodes[1].innerHTML;
						answerSheet[character] = {};
						answerSheet[character]["pronounciation"] = words[entry].childNodes[2].innerHTML;
						answerSheet[character]["translation"] = words[entry].childNodes[3].innerHTML;
						pronounciationChoices.push(answerSheet[character]["pronounciation"]);
						translationChoices.push(answerSheet[character]["translation"]);
					});
					break;
				case 1:
					Object.keys(answerSheet).forEach(copiedCharacter =>{
						pronounciationChoices.push(answerSheet[copiedCharacter]["pronounciation"]);
						translationChoices.push(answerSheet[copiedCharacter]["translation"]);
					});
					resetResults();
					break;		
				case 2:
					let tempObj = {};
					Object.keys(incorrectSheet).forEach(copiedIncorrectCharacter =>{
						tempObj[copiedIncorrectCharacter] = {};
						tempObj[copiedIncorrectCharacter]["pronounciation"] = answerSheet[copiedIncorrectCharacter]["pronounciation"];
						tempObj[copiedIncorrectCharacter]["translation"] = answerSheet[copiedIncorrectCharacter]["translation"];
						pronounciationChoices.push(answerSheet[copiedIncorrectCharacter]["pronounciation"]);
						translationChoices.push(answerSheet[copiedIncorrectCharacter]["translation"]);
					});
					answerSheet = tempObj;
					resetResults();
					break;
			}
			testSheet = shuffle(Object.keys(answerSheet));
			testIndex = 0;
			score = 0;
			maxScore = testSheet.length;
			incorrectSheet = {};
			nextQuestion(testIndex);
		}
		
		function nextQuestion(index){
			if(!testSheet[index]){
				clearInterval(questionInputTimer);
				clearInterval(testInputTimer);
				TEST_DONE = true;
				calculateScore();
				return;
			}
			if(OUT_OF_TIME){
				finalizeChoice();
				return;
			}
			let questionTimer = document.getElementById("questionTimerInput").value;
			if(QUESTION_TIMER){
				startQuestionTimer();
			}
			let currentCharacter = document.getElementById("character");
			currentCharacter.innerHTML = testSheet[index];
			let currentPronounciationChoices = generateChoices(pronounciationChoices, "pronounciation");
			currentPronounciationChoices.push(answerSheet[testSheet[index]].pronounciation);
			shuffle(currentPronounciationChoices);
			let pronounciationButtons = document.getElementById("prChoiceContainer").children;
			for(let i = 0; i < currentPronounciationChoices.length; ++i){
				pronounciationButtons[i].children[0].innerHTML = currentPronounciationChoices[i];
			}
			let currentTranslationChoices = generateChoices(translationChoices, "translation");
			currentTranslationChoices.push(answerSheet[testSheet[index]].translation);
			shuffle(currentTranslationChoices);
			let translationButtons = document.getElementById("tlChoiceContainer").children;
			for(let i = 0; i < currentTranslationChoices.length; ++i){
				translationButtons[i].children[0].innerHTML = currentTranslationChoices[i];
			}
		}
		
		function generateChoices(array, type){
			array = shuffle(array);
			let skip = false;
			let choiceArray = [];
			let length = testSheet.length;
			if(length == 3){
				length = 2;
			}else{
				length = 3;
			}
			for(let i = 0; i < length; i++){
				if(skip){
					choiceArray.push(array[i+1]);
				}else{
					let currentCharacter = document.getElementById("character").innerHTML;
					if(array[i] == answerSheet[currentCharacter][type]){
						choiceArray.push(array[i+1]);
						skip = true;
					}
					else choiceArray.push(array[i]);
				}
			}
			return choiceArray;
		}
		
		function selectChoice(currentButton, type){
			if(currentButton.innerHTML == ""){
				return;
			}
			Array.prototype.forEach.call(currentButton.parentNode.parentNode.children, div =>{
				div.children[0].style.color = "black";
			});
			window["selected" + type] = currentButton.innerHTML;
			currentButton.style.color = "blue";
			if(canNext()){
				document.getElementById("nextButton").disabled = false;
			}
		}
		
		function finalizeChoice(){
			let character = testSheet[testIndex];
			if(answerSheet[character]["pronounciation"] == selectedPronounciation && answerSheet[character]["translation"] == selectedTranslation){
				score++;
			}else{
				incorrectSheet[character] = {};
				incorrectSheet[character]["pronounciation"] = selectedPronounciation;
				incorrectSheet[character]["translation"] = selectedTranslation
			}
			studentSheet[character] = {};
			if(QUESTION_TIMER){
				studentSheet[character]["questionTimer"] = document.getElementById("questionTimer").innerHTML;
			}
			studentSheet[character]["pronounciation"] = selectedPronounciation;
			studentSheet[character]["translation"] = selectedTranslation;
			if(OUT_OF_TIME){
				selectedPronounciation = null;
				selectedTranslation = null;
				nextQuestion(++testIndex);
				return;
			}
			let prChoiceContainer = document.getElementById("prChoiceContainer").children;
			Array.prototype.forEach.call(prChoiceContainer, div =>{
				div.children[0].style.color = "black";
			});
			let tlChoiceContainer = document.getElementById("tlChoiceContainer").children;
			Array.prototype.forEach.call(tlChoiceContainer, div =>{
				div.children[0].style.color = "black";
			});
			selectedPronounciation = null;
			selectedTranslation = null;
			document.getElementById("nextButton").disabled = true;
			nextQuestion(++testIndex);
		}
		
		function canNext(){
			return (selectedPronounciation && selectedPronounciation.length > 0 &&
				selectedTranslation && selectedTranslation.length > 0);
		}
		
		function calculateScore(){
			document.getElementById("testTimer").style.display = "none";
			document.getElementById("questionTimer").style.display = "none";
			let finalScore = score/maxScore * 100 + "%";
			let fractionScore = score + "/" + maxScore;
			document.getElementById("finalScore").innerHTML = finalScore;
			document.getElementById("fractionScore").innerHTML = fractionScore;
			var index = 0;
			testSheet.forEach(character =>{
				let userSheetContainer = document.getElementById("userSheetContainer");
				appendToResults(userSheetContainer, studentSheet, character);
				let answerSheetContainer = document.getElementById("answerSheetContainer");
				appendToResults(answerSheetContainer, answerSheet, character);
				if(studentSheet[character]["pronounciation"] == answerSheet[character]["pronounciation"] && studentSheet[character]["translation"] == answerSheet[character]["translation"]){
					userSheetContainer.children[index].children[0].style.color = "green";
					userSheetContainer.children[index].children[1].style.color = "green";
					userSheetContainer.children[index].children[2].style.color = "green";
				}else{
					userSheetContainer.children[index].children[0].style.color = "red";
					if(studentSheet[character]["pronounciation"] == answerSheet[character]["pronounciation"]){
						userSheetContainer.children[index].children[1].style.color = "green";
						userSheetContainer.children[index].children[2].style.color = "red";
					}else if(studentSheet[character]["translation"] == answerSheet[character]["translation"]){
						userSheetContainer.children[index].children[1].style.color = "red";
						userSheetContainer.children[index].children[2].style.color = "green";
					}else{
						userSheetContainer.children[index].children[1].style.color = "red";
						userSheetContainer.children[index].children[2].style.color = "red";
					}
				}
				if(QUESTION_TIMER){
					let BACKSLASH = document.createElement("span");
					BACKSLASH.innerHTML = " \\";
					BACKSLASH.style.color = "black";
					userSheetContainer.children[index].children[0].appendChild(BACKSLASH);
					let timerSpan = document.createElement("span");
					timerSpan.innerHTML = " [" + studentSheet[character]["questionTimer"] + "]";
					let setQuestionTimer = Number.parseInt(studentSheet[0]["questionTimer"].replace(":", ""));
					let questionTimer = Number.parseInt(studentSheet[character]["questionTimer"].replace(":", ""));
					if(questionTimer < setQuestionTimer){
						timerSpan.style.color = "#00008b";
					}else{
						timerSpan.style.color = "#ff00f3";
					}
					userSheetContainer.children[index].children[0].appendChild(timerSpan);
				}
				index++;
			});
			document.getElementById("testContainer").style.display = "none";
			document.getElementById("testTimer").innerHTML = "";
			document.getElementById("questionTimer").innerHTML = "";
			document.getElementById("resultContainer").style.display = "block";
			if(score/maxScore == 1){
				document.getElementById("retestContainer").style.display = "none";
				document.getElementById("redownloadContainer").style.display = "none";
			}else{
				document.getElementById("retestContainer").style.display = "block";
				document.getElementById("redownloadContainer").style.display = "block";
			}
			Object.keys(incorrectSheet).forEach(character =>{
				let incorrectSheetContainer = document.getElementById("incorrectSheetContainer");
				appendToResults(incorrectSheetContainer, incorrectSheet, character);
			});
		}
		
		<!-- container : result column -->
		<!-- sheet: student, answer, or result container -->
		<!-- character: the key for the container -->
		function appendToResults(container, sheet, character){
			let divCharacter = document.createElement('div');
			divCharacter.innerHTML = character;
			divCharacter.style.width = "300px";
			divCharacter.style.padding = "1% 0";
			let divPronounciation = document.createElement('div');
			divPronounciation.innerHTML = sheet[character].pronounciation;
			divPronounciation.style.width = "300px";
			divPronounciation.style.padding = "1% 15%";
			let divTranslation = document.createElement('div');
			divTranslation.innerHTML = sheet[character]["translation"];
			divTranslation.style.width = "300px";
			divTranslation.style.padding = "1% 15%";
			let entryContainer = document.createElement('div');
			entryContainer.append(divCharacter);
			entryContainer.append(divPronounciation);
			entryContainer.append(divTranslation);
			container.append(entryContainer);
		}
		
		function startCountDownTimer(selectedTime){
			let time = selectedTime.split(":");
			let milliseconds = time[0]*60*60*1000 + time[1]*60*1000;
			let finishTime = new Date();
			finishTime.setHours(finishTime.getHours() + Number.parseInt(time[0]));
			finishTime.setMinutes(finishTime.getMinutes() + Number.parseInt(time[1]));
			testInputTimer = setInterval(function(){
				let currentTime = new Date().getTime();
				let difference = finishTime - currentTime;
				if(difference <= 0){
					clearInterval(testInputTimer);
					OUT_OF_TIME = true;
					finalizeChoice();
					return;
				}
				let hours = Math.floor((difference % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60)) + ":";
				let minutes = Math.floor((difference % (1000 * 60 * 60)) / (1000 * 60)) + ":";
				let seconds = Math.floor((difference % (1000 * 60)) / (1000)) + ":";
				let milliseconds = Math.floor(difference % 1000 / 10);
				if(milliseconds < 10){
					milliseconds *= 10;
				}
				if(checkZero(hours)){
					hours = "";
					if(checkZero(minutes)){
						minutes = "";
						if(checkZero(seconds)){
							seconds = "0:";
						}
					}
				}
				let timeString = hours + minutes + seconds + milliseconds;
				let timerDiv = document.getElementById("testTimer");
				timerDiv.innerHTML = timeString;
			}, 10);
		}
		
		function startQuestionTimer(){
			if(questionInputTimer){
				clearInterval(questionInputTimer);
			}
			let start = new Date().getTime();
			questionInputTimer = setInterval(function(){
				let currentTime = new Date().getTime();
				let difference = currentTime - start;
				//IF difference == questionTimer, call nextQuestion
				let hours = Math.floor((difference % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60)) + ":";
				let minutes = Math.floor((difference % (1000 * 60 * 60)) / (1000 * 60)) + ":";
				let seconds = Math.floor((difference % (1000 * 60)) / (1000)) + ":";
				let milliseconds = Math.floor(difference % 1000 / 10);
				if(checkZero(hours)) hours = "";
				if(checkZero(minutes)) minutes = "";
				if(checkZero(seconds)) seconds = "0:";
				if(milliseconds < 10){
					milliseconds *= 10;
				}
				if(milliseconds == 0){
					milliseconds = "00";
				}
				let timeString = hours + minutes + seconds + milliseconds;
				let questionTimerDiv = document.getElementById("questionTimer");
				questionTimerDiv.innerHTML = timeString;
				timeString = Number.parseInt(timeString.replace(":", ""));
				let questionTimer = Number.parseInt(studentSheet[0]["questionTimer"].replace(":", ""));
				if(timeString >= questionTimer && !TEST_DONE && RAPID_TEST){
					questionTimerDiv.innerHTML = studentSheet[0]["questionTimer"];
					finalizeChoice();
				}
			}, 10);
		}
		
		function checkZero(number){
			let x = Number.parseInt(number.substring(0));
			return x == 0;
		}
		
		function validTime(value, type){
			switch(type){
				case "question":
					let regex = "\\d+";
					if(!value.match(regex)){
						headerChange(4);
						return false;
					}else{
						return true;
					}
					break;
				case "timer":
					if(value.indexOf(":") <= 0 && value.indexOf(":") == (value.length - 1)){
						headerChange(3);
						return false;
					}else{
						let tempArray = value.split(":");
						let regex = "\\w+";
						if(!tempArray[0].match(regex) || !tempArray[1].match(regex)){
							headerChange(3);
							return false;
						}else{
							return true;
						}
					break;
					}
				
			}
		}
		
		function resetResults(){
			let divArray = [];
			divArray.push(document.getElementById("finalScore"));
			divArray.push(document.getElementById("fractionScore"));
			divArray.push(document.getElementById("userSheetContainer"));
			divArray.push(document.getElementById("answerSheetContainer"));
			divArray.push(document.getElementById("incorrectSheetContainer"));
			divArray.forEach(div =>{
				div.innerHTML = "";
			});
			document.getElementById("resultContainer").style.display = "none";
		}
		
		function downloadIncorrect(){
			let title = document.getElementById("bankTitle").value + "_attempt" + attempt;
			attempt++;
			let wordBank = {};
			wordBank[title] = {};
			let incorrectWords = document.getElementById("incorrectSheetContainer").children;
			Array.prototype.forEach.call(incorrectWords, function(entry){
				wordBank[title][entry.childNodes[0].innerHTML] = {};
				wordBank[title][entry.childNodes[0].innerHTML]["pronounciation"] = answerSheet[entry.childNodes[0].innerHTML]["pronounciation"];
				wordBank[title][entry.childNodes[0].innerHTML]["translation"] = answerSheet[entry.childNodes[0].innerHTML]["translation"];
			});
			let questionTimer = document.getElementById("questionTimerInput").value;
			let testTimer = document.getElementById("testTimerInput").value;
			//using the 0 integer as a field to access JSON data outside of the word banks
			if((questionTimer && questionTimer != "") || (testTimer && testTimer != "")){
				wordBank[title][0] = {};
				if(questionTimer && questionTimer != ""){
					if(validTime(questionTimer, "question")){
						wordBank[title][0]["questionTimer"] = questionTimer;
					}else{
						return;
					}
				}
				if(testTimer && testTimer != ""){
					if(validTime(testTimer, "timer")){
						wordBank[title][0]["testTimer"] = testTimer;
					}else{
						return;
					}
				}
			}
			let data = "text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(wordBank));
			let downloader = document.getElementById('redownload');
			downloader.setAttribute("href", "data:" + data);
			downloader.setAttribute("download", title + ".json");
		}
		
</script>
	<body>
		<div>
			<div>
				<div id = "testTimer" style = "display: none"><span id = "testTimerSpan"> [ TEST TIMER ] </span>
				</div>
				<div id = "questionTimer" style = "display: none"><span id = "questionTimerSpan"> [ QUESTION TIMER ] </span>
				</div>
				<div id = "uiContainer">
					<div style = "text-align: center; padding: .5%; font-size: 24pt; font-weight: bold">
						Vocabulary Reviewer
					</div>
					<div style = "display: flex; justify-content: center; padding-top: .5%">
						<div style = "border: 2px solid; border-color: red; padding: 1%">
							<div style = "padding: 5px 0px 5px; text-align: center">
								Create your own word bank
							</div>
							<div class = 'input' style = "text-align: center; padding-right: 1%">
								Title of Word Bank: <input id = "bankTitle" form = "text" />
							</div>
							<div style = "display: flex; justify-content: center; padding: 5px 0px 5px;">
								<div style = "padding: 0 .5% 0 0;">
									Select/Edit Banks:
								</div>
								<div>
									<input type = "file" id = "jsonInputs" accepts = ".json" onClick= "this.value=null" multiple />
								</div>
								<div>
									<button id = "startButton" onClick = "startTest(0)">
										Start Test
									</button>
								</div>
							</div>
							<div id = "questionTimerContainer" style = "text-align: center; padding-bottom: 5px; padding-left: 13.8%">
								Question Timer (Optional): How many seconds per question? <input id = "questionTimerInput" form = "text" /> 
								<input id = "rapidCheckBox" type = "checkbox" /><span>Rapid Fire Testing</span>
							</div>
							<div id = "testTimerContainer" style = "text-align: center">
								Test Length (Optional): Enter time in HOUR:MINUTE format <input id = "testTimerInput" form = "text" />
							</div>
							<div style = "display: flex">
								<div class = 'inputContainer'>
									Character: <input id = 'inputCharacter'  form = "text"/>
								</div>
								<div class = 'inputContainer'>
									Pronounciation: <input id = 'inputPronounciation' form = "text" />
								</div>
								<div class = 'inputContainer'>
									English Translation: <input id = 'inputTranslation' form = "text" />
								</div>
								<div style = " padding: 5px 0px 5px">
									<button id = "enterButton" style = "margin-right: 10px">
										Enter
									</button>
									<a id = "download">
										<button id = "submitButton" type = "submit" onClick = "createBank()" style = "margin-right: 10px">
											Create Test
										</button>
									</a>
								</div>
							</div>
						</div>
					</div>
					<div style = "display: flex; padding: 1% 0">
						<div class = 'fieldContainer' style = "padding: .25% 2.8% .25% 24.5%">
							Index
						</div>
						<div class = 'fieldContainer' style = "padding: .25% 3% .25% 1.5%">
							Character
						</div>
						<div class = 'fieldContainer' style = "padding: .25% 6.5% .25% 3%">
							Pronounciation
						</div>
						<div class = 'fieldContainer' style = "padding-left: 6.5%">
							English Translation
						</div>
					</div>						
				</div>
				<div id = "bankUiContainer" style = "display: flex; justify-content: center">
					<div id = "bankContainer" style = "justify-content: center; display: flex; padding-left: 8.95%">
						<div id = "bank" style = "border:1px solid; padding:10px; margin : 5px; width: 1100px">
							<div id = "headerContainer" style = "font-style: italic; width: 100%">
								<div id = "headerText">
									The word bank is currently empty.
								</div>
								<div id = "headerBreak" style = "display: none">
									<br />
								</div>
							</div>
							<div id = "words" style = "font-size: 18pt"></div>
						</div>
					</div>
					<div>
						<div style = "border:1px solid; padding:10px; margin: 5px 5px 5px 20px; width: 12%: height: auto">
							<div style = "text-align: center">
								Word Banks Used
							</div>
							<div id = "wordBanksUsedDiv">
							</div>
							<div class = "break">
							</div>
						</div>
					</div>
				</div>
				<div id = "testContainer" style = "display: none">
					<div style = "justify-content: center;display: flex">
						<div style = "border: 1px solid; padding 10px; margin: 5px 5px 5px 20px; width: 23%; height: 200px; text-align: center">
							<div id = "character" style = "padding: 66px 0; font-size: 36pt; font-weight: bold">
							</div>
						</div>
					</div>
					<div style = "padding: 1% 0; text-align: center">
						<div>
							Pronounciation
						</div>
						<div id = "prChoiceContainer" style = "justify-content: center; display: flex">
							<div class = "choiceContainer">
								<button onClick = "selectChoice(this, 'Pronounciation')"></button>
							</div>
							<div class = "choiceContainer">
								<button onClick = "selectChoice(this, 'Pronounciation')"></button>
							</div>
							<div class = "choiceContainer">
								<button onClick = "selectChoice(this, 'Pronounciation')"></button>
							</div>
							<div class = "choiceContainer">
								<button onClick = "selectChoice(this, 'Pronounciation')"></button>
							</div>
						</div>
					</div>
					<div style = "padding: 1% 0; text-align: center">
						<div>
							Translation
						</div>
						<div id = "tlChoiceContainer" style = "justify-content: center; display: flex">
							<div class = "choiceContainer">
								<button onClick = "selectChoice(this, 'Translation')"></button>
							</div>
							<div class = "choiceContainer">
								<button onClick = "selectChoice(this, 'Translation')"></button>
							</div>
							<div class = "choiceContainer">
								<button onClick = "selectChoice(this, 'Translation')"></button>
							</div>
							<div class = "choiceContainer">
								<button onClick = "selectChoice(this, 'Translation')"></button>
							</div>
						</div>
					</div>
					<div style = "padding: 3% 5%; text-align: center;">
						<div>
							<button id = "nextButton" style = "font-size: 22pt" onClick = "finalizeChoice()" disabled>
								Next
							</button>
						</div>
					</div>
				</div>
				<div id = "resultContainer" style = "display: none">
					<div id = "finalScore" style = "text-align: center">
					</div>
					<div id = "fractionScore" style = "text-align: center">
					</div>
					<div id = "sheetFlexContainer" style = "justify-content: center; display: flex; padding-left: 150px">
						<div id = "userSheetContainer">
						</div>
						<div id = "answerSheetContainer">
						</div>
						<div id = "incorrectSheetContainer">
						</div>
					</div>
					<div class = "break">
					</div>
					<div id = "retryContainer" style = "display: flex; justify-content: center;">
						<div id = "retryContainer" style = "padding: 1%">
							<button onClick = "startTest(1)" style = "padding: 2%; font-size: 20pt">Retry</button>
						</div>
						<div id = "retestContainer" style = "padding: 1%">
							<button onClick = "startTest(2)" style = "padding: 2%; font-size: 20pt">Retest</button>
						</div>
						<div id = "redownloadContainer" style = "padding: 1%">
							<a id = "redownload">
								<button onClick = "downloadIncorrect()" style = "padding: 2%; font-size: 20pt">Redownload</button>
							</a>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<script>
			document.getElementById("jsonInputs").addEventListener('change', onChange);
			document.getElementById("enterButton").onclick = function(){insertWord(document.getElementById("inputCharacter").value,					
				document.getElementById("inputPronounciation").value,
				document.getElementById("inputTranslation").value)};
		</script>
	</body>
</html>
